{"version":3,"sources":["../src/messages.js"],"names":["define","$","PubSub","openedpopovers","maxWidth","init","length","drawermessage","css","animate","width","document","addEventListener","hasClass","window","hide","show","popover","on","popovername","attr","indexOf","push","bind","index","splice","subscribe","args","redirectToMessage","processedId","userid","parseInt","moodleurl","M","cfg","wwwroot","location","concat"],"mappings":"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","sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package   theme_snap\n * @author    Juan Ibarra juan.ibarra@openlms.net\n * @copyright Copyright (c) 2019 Open LMS (https://www.openlms.net)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * JS code to manage hide/show of full width messages drawer.\n */\ndefine(['jquery', 'core/pubsub'],\n    function($, PubSub) {\n        // Array to control which popovers are open.\n        var openedpopovers = [];\n        // Maximum size in pixels to consider a mobile screen\n        var maxWidth = 560;\n\n        return {\n            init: function() {\n                // Listener for the admin block.\n                if ($('.preferences-page-container').length === 0 && $('.message-app.main').length === 0 &&\n                        ($('#page-message-edit').length != 0 || $('#page-message-index').length != 0)) {\n                    var drawermessage = $('.drawer .message-app');\n                    drawermessage.css('visibility', 'visible');\n                    drawermessage.animate({width: '100%'}, 0);\n                    document.addEventListener(\"messages-drawer:toggle\", function () {\n                        if ($('#page-message-edit').length || $('#page-message-index').length) {\n                            if ($('.block_settings').hasClass('state-visible')) {\n                                if ($(window).width() < maxWidth) {\n                                    $('.drawer .message-app').hide();\n                                } else {\n                                    $('.drawer .message-app').animate({width: '50%'}, 0);\n                                }\n                            } else {\n                                if ($(window).width() < maxWidth) {\n                                    $('.drawer .message-app').show();\n                                } else {\n                                    $('.drawer .message-app').animate({width: '100%'}, 0);\n                                }\n                            }\n                        }\n                    });\n                    // Listener for the personal menu.\n                    document.addEventListener(\"messages-drawer:pm-toggle\", function () {\n                        if ($('#page-message-edit').length || $('#page-message-index').length) {\n                            if ($('.snap-pm-open').length) {\n                                $('.drawer .message-app').hide();\n                            } else {\n                                $('.drawer .message-app').show();\n                            }\n                        }\n                    });\n                    // Listeners for popovers.\n                    var popover = $('div.popover-region');\n                    popover.on('popoverregion:menuopened', function () {\n                        if ($('#page-message-edit').length || $('#page-message-index').length) {\n                            var popovername = $(this).attr(\"id\");\n                            if (openedpopovers.indexOf(popovername) == -1) {\n                                openedpopovers.push(popovername);\n                            }\n                            // If there are open popovers, hide message-drawer.\n                            if (openedpopovers.length > 0) {\n                                if ($(window).width() < maxWidth) {\n                                    $('.drawer .message-app').hide();\n                                } else {\n                                    $('.drawer .message-app').animate({width: '50%'}, 0);\n                                }\n                            }\n                        }\n                    }).bind();\n                    popover.on('popoverregion:menuclosed', function () {\n                        if ($('#page-message-edit').length || $('#page-message-index').length) {\n                            var popovername = $(this).attr(\"id\");\n                            var index = openedpopovers.indexOf(popovername);\n                            openedpopovers.splice(index, 1);\n                            // Only open drawer when there are no opened popovers.\n                            if (openedpopovers.length == 0) {\n                                if ($(window).width() < maxWidth) {\n                                    $('.drawer .message-app').show();\n                                } else {\n                                    $('.drawer .message-app').animate({width: '100%'}, 0);\n                                }\n                            }\n                        }\n                    }).bind();\n                // Listener for the page user profile to load messages URL.\n                } else if ($('#page-user-profile').length != 0 || $('.userprofile #message-user-button').length != 0) {\n                    PubSub.subscribe(\"message-drawer-create-conversation-with-user\", function (args) {\n                        this.redirectToMessage(args);\n                    });\n                    // The drawer in snap will always open in a new window\n                    PubSub.subscribe(\"message-drawer-show-conversation\", function (args) {\n                        this.redirectToMessage(args);\n                    });\n                }\n            },\n            redirectToMessage : function(args) {\n                let processedId = '';\n                if (typeof args === 'object' && args.userid) {\n                    processedId = parseInt(args.userid);\n                } else {\n                    processedId = parseInt(args);\n                }\n                const moodleurl = M.cfg.wwwroot;\n                window.location = moodleurl.concat('/message/index.php?id=', processedId);\n            }\n        };\n    }\n);\n"],"file":"messages.min.js"}